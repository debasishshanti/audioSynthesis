<!DOCTYPE html>
<html>
<head>
	<title>Mary had a little lamb</title>
</head>
<body>
	<button onclick="start()">Start</button>
	<button onclick="stop()">Stop</button>
	<br/><br/>
	<div class="code">
		<pre>
			 var audio = new AudioContext() || new window.webkitAudioContext(),
		        position = 0,
		        scale = {
		            g: 392,
		            f: 349.23,
		            e: 329.63,
		            b: 493.88
		        },
		        song = "gfefgg-fff-gbb-gfefggggffgfe---";

		    setInterval(play, 1000 / 4);

		    function createOscillator(freq) {
		        var osc = audio.createOscillator();

		        osc.frequency.value = freq;
		        osc.type = "square";
		        osc.connect(audio.destination);
		        osc.start(0);

		        setTimeout(function() {
		            osc.stop(0);
		            osc.disconnect(audio.destination);
		        }, 1000 / 4)
		    }

		    function play() {
		        var note = song.charAt(position),
		            freq = scale[note];
		        position += 1;
		        if(position >= song.length) {
		            position = 0;
		        }
		        if(freq) {
		            createOscillator(freq);
		        }
		    }
		</pre>
	</div>
	<div class="links">
		<a href="song-mary-v1.html">Prev</a>
		<a href="song-mary-had-a-little-lamb.html">Next</a>
	</div>
	<script type="text/javascript">
		var audio = new AudioContext() || new window.webkitAudioContext(),
			osc = audio.createOscillator(),
	        position = 0,
	        scale = {
	            g: 392,
	            f: 349.23,
	            e: 329.63,
	            b: 493.88
	        },
	        song = "gfefgg-fff-gbb-gfefggggffgfe---";

	        osc.connect(audio.destination);

	        var timer;
		function start() {
			timer = setInterval(play, 1000 / 4);
		}

		function createOscillator(freq) {
	        var osc = audio.createOscillator();

	        osc.frequency.value = freq;
	        osc.type = "square";
	        osc.connect(audio.destination);
	        osc.start(0);

	        setTimeout(function() {
	            osc.stop(0);
	            osc.disconnect(audio.destination);
	        }, 1000 / 4)
	    }

	    function play() {
	        var note = song.charAt(position),
	            freq = scale[note];
	        position += 1;
	        if(position >= song.length) {
	            position = 0;
	        }
	        if(freq) {
	            createOscillator(freq);
	        }
	    }

		function stop() {
			clearInterval(timer);
			position = 0;
		}
	</script>
</body>
</html>